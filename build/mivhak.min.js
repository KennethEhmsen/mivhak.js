/**
 * Package: mivhak-js
 * URL:     http://products.askupasoftware.com/mivhak-js
 * Version: 1.0.0
 * Date:    2016-06-08
 * License: GNU GENERAL PUBLIC LICENSE
 *
 * Developed by Askupa Software http://www.askupasoftware.com
 */
!function(a){function b(a){return"true"===a.toLowerCase()?!0:"false"===a.toLowerCase()?!1:isNaN(a)?a:parseInt(a)}function c(a){return a.replace(/-(.)/g,function(a){return a[1].toUpperCase()})}function d(b,c){this.$selection=a(b),this.setOptions(c),this.init()}ace.config.set("basePath","https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/"),d.methods={},d.methodExists=function(a){return"string"==typeof a&&d.methods[a]},d.readAttributes=function(d){var e={};return a.each(d.attributes,function(a,d){/^miv-/.test(d.name)&&(e[c(d.name.substr(4))]=b(d.value))}),e},d.prototype.setOptions=function(b){"undefined"!=typeof this.options?this.options=a.extend({},this.options,b,d.readAttributes(this.$selection[0])):this.options=a.extend({},d.defaults,b,d.readAttributes(this.$selection[0]))},d.render=function(b,c){var e=a.extend(!0,{},d.components[b]),f={};return f.$el=a(e.template),a.each(e.methods,function(a,b){f[a]=function(){return b.apply(f,arguments)}}),a.each(e.props,function(a,b){f[a]="undefined"!=typeof c&&c.hasOwnProperty(a)?c[a]:b}),a.each(e.events,function(a,b){f.$el.on(a,function(){return b.apply(f,arguments)})}),e.hasOwnProperty("created")&&e.created.call(f),f},d.prototype.init=function(){this.createTabs(),this.createTopBar()},d.prototype.createTabs=function(){this.tabs=d.render("tabs",{mivhakInstance:this}),this.$selection.prepend(this.tabs.$el)},d.prototype.createTopBar=function(){this.topbar=d.render("top-bar",{mivhakInstance:this}),this.$selection.prepend(this.topbar.$el)},d.defaults={runnable:!1,editable:!1,lineNumbers:!1,collapsed:!1,theme:"light",height:"auto",buttons:["wrap","copy","collapse","about"],ace:{}},d.components=[],d.component=function(a,b){d.components[a]=b},d.component("tab-pane",{template:'<div class="mivhak-tab-pane"></div>',props:{pre:null,editor:null,mivhakInstance:null},created:function(){this.setOptions(),this.pre.innerText=this.pre.innerText.trim(),this.editor=ace.edit(this.pre),this.editor.setReadOnly(!this.mivhakInstance.options.editable),this.editor.setTheme("ace/theme/"+this.getTheme()),this.editor.setShowPrintMargin(!1),this.editor.renderer.setShowGutter(this.mivhakInstance.options.lineNumbers),this.editor.getSession().setMode("ace/mode/"+this.lang),this.editor.getSession().setUseWorker(!1),this.editor.setOptions({maxLines:1/0,firstLineNumber:1,highlightActiveLine:!1,fontSize:parseInt(14)}),this.$el=a(this.pre).wrap(this.$el).parent()},methods:{getTheme:function(){return"light"===this.mivhakInstance.options.theme?"clouds":"ambiance"},setOptions:function(){var b=this;a.each(d.readAttributes(this.pre),function(a,c){b[a]=c})},show:function(){this.$el.addClass("mivhak-tab-pane-active"),this.editor.focus(),this.editor.gotoLine(0)},hide:function(){this.$el.removeClass("mivhak-tab-pane-active")}}}),d.component("tabs",{template:'<div class="mivhak-tabs"></div>',props:{mivhakInstance:null,tabs:[]},created:function(){var a=this;this.$el=this.mivhakInstance.$selection.find("pre").wrapAll(this.$el).parent(),this.mivhakInstance.$selection.find("pre").each(function(){a.tabs.push(d.render("tab-pane",{pre:this,mivhakInstance:a.mivhakInstance}))}),this.showTab(0)},methods:{showTab:function(b){a.each(this.tabs,function(a,c){b===a?c.show():c.hide()})}}}),d.component("toggle",{template:'<div class="mivhak-toggle"><div class="mivhak-toggle-knob"></div></div>',props:{on:!0},events:{click:function(){this.toggle()}},created:function(){this.$el.addClass("mivhak-toggle-"+(this.on?"on":"off"))},methods:{toggle:function(){this.on=!this.on,this.$el.toggleClass("mivhak-toggle-on").toggleClass("mivhak-toggle-off")}}}),d.component("top-bar-button",{template:'<div class="mivhak-top-bar-button"></div>',props:{text:null,onClick:function(){}},events:{click:function(){this.onClick()}},created:function(){this.$el.text(this.text)}}),d.component("top-bar",{template:'<div class="mivhak-top-bar"><div class="mivhak-nav-tabs"></div><div class="mivhak-controls"></div></div>',props:{mivhakInstance:null,leftButtons:[],rightButtons:[]},created:function(){var b=this;a.each(this.mivhakInstance.tabs.tabs,function(a,c){var e=d.render("top-bar-button",{text:c.lang,onClick:function(){b.mivhakInstance.tabs.showTab(a)}});b.leftButtons.push(e),b.$el.find(".mivhak-nav-tabs").append(e.$el)})},methods:{}}),a.fn.mivhak=function(b){var c=arguments.length>1?Array.apply(null,arguments).slice(1):null;return this.each(function(){if("object"!=typeof b&&b)d.methodExists(b)&&d.methods[b].call(a(this).data("mivhak"),c);else if("undefined"==typeof a(this).data("mivhak")){var e=new d(this,b);a(this).data("mivhak",e)}else d.methods.update.call(a(this).data("mivhak"),[b])})}}(jQuery);