/**
 * Package:      mivhak-js
 * URL:          http://products.askupasoftware.com/mivhak-js
 * Version:      1.0.0
 * Date:         2016-06-20
 * Dependencies: jQuery Mousewheel, clipboard.js
 * License:      GNU GENERAL PUBLIC LICENSE
 *
 * Developed by Askupa Software http://www.askupasoftware.com
 */
!function(a){function b(a){return"true"===a.toLowerCase()?!0:"false"===a.toLowerCase()?!1:isNaN(a)?a:parseFloat(a)}function c(a){return a.replace(/-(.)/g,function(a){return a[1].toUpperCase()})}function d(d){var e={};return a.each(d.attributes,function(a,d){/^miv-/.test(d.name)&&(e[c(d.name.substr(4))]=b(d.value))}),e}function e(b,c){this.$selection=a(b),this.setOptions(c),this.init()}ace.config.set("basePath","https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/");var f=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1e3/60)};e.methodExists=function(a){return"string"==typeof a&&e.methods[a]},e.prototype.state={lineWrap:!0,collapsed:!1,activeTab:0},e.prototype.setOptions=function(b){"undefined"!=typeof this.options?this.options=a.extend(!0,{},this.options,b,d(this.$selection[0])):this.options=a.extend(!0,{},e.defaults,b,d(this.$selection[0]))},e.prototype.callMethod=function(a){if(e.methodExists(a)){var b=[];Array.prototype.push.apply(b,arguments),b.shift(),e.methods[a].apply(this,b)}},e.render=function(b,c){var d=a.extend(!0,{},e.components[b]),f={};return f.$el=a(d.template),a.each(d.methods,function(a,b){f[a]=function(){return b.apply(f,arguments)}}),a.each(d.props,function(a,b){f[a]="undefined"!=typeof c&&c.hasOwnProperty(a)?c[a]:b}),a.each(d.events,function(a,b){f.$el.on(a,function(){return b.apply(f,arguments)})}),d.hasOwnProperty("created")&&d.created.call(f),f},e.prototype.init=function(){this.createTabs(),this.createTopBar(),this.callMethod("setHeight",150),this.callMethod("showTab",0)},e.prototype.createTabs=function(){this.tabs=e.render("tabs",{mivhakInstance:this}),this.$selection.prepend(this.tabs.$el)},e.prototype.createTopBar=function(){this.topbar=e.render("top-bar",{mivhakInstance:this}),this.$selection.prepend(this.topbar.$el)},e.defaults={runnable:!1,editable:!1,lineNumbers:!1,accentColor:"currentColor",collapsed:!1,theme:"light",height:"auto",buttons:["wrap","copy","collapse","about"],ace:{}},e.methods={toggleLineWrap:function(){var b=this;this.state.lineWrap=!this.state.lineWrap,a.each(this.tabs.tabs,function(a,c){c.editor.getSession().setUseWrapMode(b.state.lineWrap),c.vscroll.onHeightChange(),c.hscroll.onWidthChange()})},showTab:function(a){this.tabs.showTab(a),this.topbar.activateNavTab(a)},setHeight:function(b){this.tabs.$el.height(b),a.each(this.tabs.tabs,function(c,d){a(d.pre).height(b),d.editor.resize()})},update:function(a){}},e.icons={},e.icons.play='<svg viewBox="0 0 232.153 232.153"><g><path style="fill-rule:evenodd;clip-rule:evenodd;" d="M203.791,99.628L49.307,2.294c-4.567-2.719-10.238-2.266-14.521-2.266c-17.132,0-17.056,13.227-17.056,16.578v198.94c0,2.833-0.075,16.579,17.056,16.579c4.283,0,9.955,0.451,14.521-2.267l154.483-97.333c12.68-7.545,10.489-16.449,10.489-16.449S216.471,107.172,203.791,99.628z"/></g></svg>',e.icons.cog='<svg viewbox="0 0 438.529 438.529"><g><path d="M436.25,181.438c-1.529-2.002-3.524-3.193-5.995-3.571l-52.249-7.992c-2.854-9.137-6.756-18.461-11.704-27.98c3.422-4.758,8.559-11.466,15.41-20.129c6.851-8.661,11.703-14.987,14.561-18.986c1.523-2.094,2.279-4.281,2.279-6.567c0-2.663-0.66-4.755-1.998-6.28c-6.848-9.708-22.552-25.885-47.106-48.536c-2.275-1.903-4.661-2.854-7.132-2.854c-2.857,0-5.14,0.855-6.854,2.567l-40.539,30.549c-7.806-3.999-16.371-7.52-25.693-10.565l-7.994-52.529c-0.191-2.474-1.287-4.521-3.285-6.139C255.95,0.806,253.623,0,250.954,0h-63.38c-5.52,0-8.947,2.663-10.278,7.993c-2.475,9.513-5.236,27.214-8.28,53.1c-8.947,2.86-17.607,6.476-25.981,10.853l-39.399-30.549c-2.474-1.903-4.948-2.854-7.422-2.854c-4.187,0-13.179,6.804-26.979,20.413c-13.8,13.612-23.169,23.841-28.122,30.69c-1.714,2.474-2.568,4.664-2.568,6.567c0,2.286,0.95,4.57,2.853,6.851c12.751,15.42,22.936,28.549,30.55,39.403c-4.759,8.754-8.47,17.511-11.132,26.265l-53.105,7.992c-2.093,0.382-3.9,1.621-5.424,3.715C0.76,182.531,0,184.722,0,187.002v63.383c0,2.478,0.76,4.709,2.284,6.708c1.524,1.998,3.521,3.195,5.996,3.572l52.25,7.71c2.663,9.325,6.564,18.743,11.704,28.257c-3.424,4.761-8.563,11.468-15.415,20.129c-6.851,8.665-11.709,14.989-14.561,18.986c-1.525,2.102-2.285,4.285-2.285,6.57c0,2.471,0.666,4.658,1.997,6.561c7.423,10.284,23.125,26.272,47.109,47.969c2.095,2.094,4.475,3.138,7.137,3.138c2.857,0,5.236-0.852,7.138-2.563l40.259-30.553c7.808,3.997,16.371,7.519,25.697,10.568l7.993,52.529c0.193,2.471,1.287,4.518,3.283,6.14c1.997,1.622,4.331,2.423,6.995,2.423h63.38c5.53,0,8.952-2.662,10.287-7.994c2.471-9.514,5.229-27.213,8.274-53.098c8.946-2.858,17.607-6.476,25.981-10.855l39.402,30.84c2.663,1.712,5.141,2.563,7.42,2.563c4.186,0,13.131-6.752,26.833-20.27c13.709-13.511,23.13-23.79,28.264-30.837c1.711-1.902,2.569-4.09,2.569-6.561c0-2.478-0.947-4.862-2.857-7.139c-13.698-16.754-23.883-29.882-30.546-39.402c3.806-7.043,7.519-15.701,11.136-25.98l52.817-7.988c2.279-0.383,4.189-1.622,5.708-3.716c1.523-2.098,2.279-4.288,2.279-6.571v-63.376C438.533,185.671,437.777,183.438,436.25,181.438z M270.946,270.939c-14.271,14.277-31.497,21.416-51.676,21.416c-20.177,0-37.401-7.139-51.678-21.416c-14.272-14.271-21.411-31.498-21.411-51.673c0-20.177,7.135-37.401,21.411-51.678c14.277-14.272,31.504-21.411,51.678-21.411c20.179,0,37.406,7.139,51.676,21.411c14.274,14.277,21.413,31.501,21.413,51.678C292.359,239.441,285.221,256.669,270.946,270.939z"/></g></svg>',e.components=[],e.component=function(a,b){e.components[a]=b},e.component("dropdown",{template:'<div class="mivhak-dropdown"></div>',props:{items:[],mivhakInstance:null,visible:!1},created:function(){var b=this;a.each(this.items,function(c,d){"string"==typeof d&&(d=g[d]);var f=a("<div>",{"class":"mivhak-dropdown-button",text:d.text,click:function(a){d.click.call(b.mivhakInstance,a)}});d.toggle&&(f.$toggle=e.render("toggle"),f.click(function(b){1!==a(b.target).parents(".mivhak-dropdown-button").length&&f.$toggle.toggle()}),f.append(f.$toggle.$el)),b.$el.append(f)})},methods:{toggle:function(){this.visible=!this.visible,this.$el.toggleClass("mivhak-dropdown-visible")}}});var g={wrap:{text:"Wrap Lines",toggle:!0,click:function(a){a.stopPropagation(),this.callMethod("toggleLineWrap")}},copy:{text:"Copy",click:function(a){a.stopPropagation(),console.log("copy called")}},collapse:{text:"Colllapse",click:function(a){a.stopPropagation(),console.log("Colllapse called")}},about:{text:"About Mivhak",click:function(a){a.stopPropagation(),console.log("about called")}}};e.component("horizontal-scrollbar",{template:'<div class="mivhak-scrollbar mivhak-h-scrollbar"><div class="mivhak-scrollbar-thumb"></div></div>',props:{editor:null,$inner:null,$outer:null,state:{a:null,b:null,c:null,l:null},initialized:!1},methods:{initialize:function(){this.initialized||(this.initialized=!0,this.state.a=this.$inner.width(),this.state.b=this.$outer.parent().width(),this.state.c=this.$outer.width(),this.state.t=0,this.dragDealer(),this.stateUpdated())},stateUpdated:function(){if(this.getDifference()>0){var a=this.state;this.$el.css({width:a.c*a.b/a.a+"px",left:0}),this.moveBar()}else this.$el.css({width:0})},onWidthChange:function(){var a=this.getEditorWidth(),b=this.state.l;this.state.l*=a/this.state.a,this.doScroll("left",b-this.state.l),this.state.a=a,this.stateUpdated()},dragDealer:function(){function b(a){var b,c=a.pageX-d;c&&(d=a.pageX,f(function(){b=e.doScroll(c>0?"right":"left",Math.abs(c*e.getEditorWidth()/e.$outer.parent().width())),0!==b&&e.moveBar()}))}function c(){e.$el.add(document.body).removeClass("mivhak-scrollbar-grabbed"),a(document).off("mousemove.drag mouseup.drag")}var d,e=this;this.$el.on("mousedown.drag",function(f){return d=f.pageX,e.$el.add(document.body).addClass("mivhak-scrollbar-grabbed"),a(document).on("mousemove.drag",b).on("mouseup.drag",c),!1})},moveBar:function(){this.$el.css({left:this.state.l/this.state.a*this.state.b+"px"})},doScroll:function(a,b){var c,d,e=this.state;return"left"===a&&(c=e.l,d=c>0?Math.min(c,b):0,e.l-=d),"right"===a&&(c=this.getDifference()-e.l,d=c>0?Math.min(c,b):0,e.l+=d),this.$inner.find(".ace_content").css({"margin-left":-e.l}),d},getDifference:function(){return this.state.a-this.state.c},getEditorWidth:function(){return this.$inner.find(".ace_content").width()}}}),e.component("tab-pane",{template:'<div class="mivhak-tab-pane"><div class="mivhak-tab-pane-inner"></div></div>',props:{pre:null,editor:null,padding:10,mivhakInstance:null},created:function(){this.setOptions(),this.setEditor(),this.$el=a(this.pre).wrap(this.$el).parent().parent(),this.setScrollbars()},methods:{getTheme:function(){return"light"===this.mivhakInstance.options.theme?"clouds":"ambiance"},setOptions:function(){var b=this;a.each(d(this.pre),function(a,c){b[a]=c})},setScrollbars:function(){var b=a(this.pre),c=this.$el.find(".mivhak-tab-pane-inner");this.vscroll=e.render("vertical-scrollbar",{editor:this.editor,$inner:b,$outer:c}),this.hscroll=e.render("horizontal-scrollbar",{editor:this.editor,$inner:b,$outer:c}),this.$el.append(this.vscroll.$el,this.hscroll.$el)},show:function(){this.$el.addClass("mivhak-tab-pane-active"),this.editor.focus(),this.editor.gotoLine(0),this.vscroll.initialize(),this.hscroll.initialize()},hide:function(){this.$el.removeClass("mivhak-tab-pane-active")},setEditor:function(){this.pre.textContent=this.pre.textContent.trim(),this.editor=ace.edit(this.pre),this.editor.setReadOnly(!this.mivhakInstance.options.editable),this.editor.setTheme("ace/theme/"+this.getTheme()),this.editor.setShowPrintMargin(!1),this.editor.renderer.setShowGutter(this.mivhakInstance.options.lineNumbers),this.editor.getSession().setMode("ace/mode/"+this.lang),this.editor.getSession().setUseWorker(!1),this.editor.getSession().setUseWrapMode(!0),this.editor.setOptions({maxLines:1/0,firstLineNumber:1,highlightActiveLine:!1,fontSize:parseInt(14)})}}}),e.component("tabs",{template:'<div class="mivhak-tabs"></div>',props:{mivhakInstance:null,tabs:[]},created:function(){var a=this;this.$el=this.mivhakInstance.$selection.find("pre").wrapAll(this.$el).parent(),this.mivhakInstance.$selection.find("pre").each(function(){a.tabs.push(e.render("tab-pane",{pre:this,mivhakInstance:a.mivhakInstance}))})},methods:{showTab:function(b){a.each(this.tabs,function(a,c){b===a?c.show():c.hide()})}}}),e.component("toggle",{template:'<div class="mivhak-toggle"><div class="mivhak-toggle-knob"></div></div>',props:{on:!0},events:{click:function(){this.toggle()}},created:function(){this.$el.addClass("mivhak-toggle-"+(this.on?"on":"off"))},methods:{toggle:function(){this.on=!this.on,this.$el.toggleClass("mivhak-toggle-on").toggleClass("mivhak-toggle-off")}}}),e.component("top-bar-button",{template:'<div class="mivhak-top-bar-button"></div>',props:{text:null,icon:null,dropdown:null,mivhakInstance:null,onClick:function(){}},events:{click:function(){this.onClick()}},created:function(){var b=this;this.$el.text(this.text),this.icon&&this.$el.addClass("mivhak-icon mivhak-icon-"+this.icon).append(a(e.icons[this.icon])),this.dropdown&&(b.$el.append(this.dropdown.$el),this.onClick=function(){b.toggleActivation(),b.dropdown.toggle()})},methods:{activate:function(){this.$el.addClass("mivhak-button-active")},deactivate:function(){this.$el.removeClass("mivhak-button-active")},toggleActivation:function(){this.$el.toggleClass("mivhak-button-active")},isActive:function(){return this.$el.hasClass("mivhak-button-active")}}}),e.component("top-bar",{template:'<div class="mivhak-top-bar"><div class="mivhak-nav-tabs"></div><div class="mivhak-controls"></div><div class="mivhak-line"></div></div>',props:{mivhakInstance:null,navTabs:[],controls:[],line:null},created:function(){var b=this;this.line=this.$el.find(".mivhak-line"),a.each(this.mivhakInstance.tabs.tabs,function(a,c){var d=e.render("top-bar-button",{text:c.lang,onClick:function(){b.mivhakInstance.callMethod("showTab",a)}});b.navTabs.push(d),b.$el.find(".mivhak-nav-tabs").append(d.$el)}),b.controls.push(e.render("top-bar-button",{icon:"play",mivhakInstance:b.mivhakInstance,onClick:function(){}})),b.controls.push(e.render("top-bar-button",{icon:"cog",mivhakInstance:b.mivhakInstance,dropdown:e.render("dropdown",{mivhakInstance:b.mivhakInstance,items:this.mivhakInstance.options.buttons})})),b.$el.find(".mivhak-controls").append(b.controls[0].$el,b.controls[1].$el)},methods:{activateNavTab:function(b){var c=this.navTabs[b];a.each(this.navTabs,function(a,b){b.deactivate()}),c.activate(),this.line.width(c.$el.width()),this.line.css({left:c.$el.position().left+(c.$el.outerWidth()-c.$el.width())/2})}}}),e.component("vertical-scrollbar",{template:'<div class="mivhak-scrollbar mivhak-v-scrollbar"><div class="mivhak-scrollbar-thumb"></div></div>',props:{editor:null,$inner:null,$outer:null,state:{a:null,b:null,c:null,t:null},initialized:!1},methods:{initialize:function(){if(!this.initialized&&(this.initialized=!0,this.state.a=this.getEditorHeight(),this.state.b=this.$outer.parent().height(),this.state.c=this.$outer.height(),this.state.t=0,this.getDifference()>0)){var a=this;this.dragDealer(),this.$inner.on("mousewheel",function(b){a.onScroll.call(this,b)}),this.stateUpdated()}},stateUpdated:function(){var a=this.state;this.$el.css({height:a.c*a.b/a.a+"px",top:0}),this.moveBar()},onHeightChange:function(){var a=this.getEditorHeight(),b=this.state.t;this.state.t*=a/this.state.a,this.doScroll("up",b-this.state.t),this.state.a=a,this.stateUpdated()},onScroll:function(a){var b;b=a.deltaY>0?this.doScroll("up",a.deltaY):this.doScroll("down",-a.deltaY),0!==b&&(this.moveBar(),a.preventDefault())},dragDealer:function(){function b(a){var b,c=a.pageY-d;c&&(d=a.pageY,f(function(){b=e.doScroll(c>0?"down":"up",Math.abs(c*e.getEditorHeight()/e.$outer.parent().height())),0!==b&&e.moveBar()}))}function c(){e.$el.add(document.body).removeClass("mivhak-scrollbar-grabbed"),a(document).off("mousemove.drag mouseup.drag")}var d,e=this;this.$el.on("mousedown.drag",function(f){return d=f.pageY,e.$el.add(document.body).addClass("mivhak-scrollbar-grabbed"),a(document).on("mousemove.drag",b).on("mouseup.drag",c),!1})},moveBar:function(){this.$el.css({top:this.state.t/this.state.a*this.state.b+"px"})},doScroll:function(a,b){var c,d,e=this.state;return"up"===a&&(c=e.t,d=c>0?Math.min(c,b):0,e.t-=d),"down"===a&&(c=this.getDifference()-e.t,d=c>0?Math.min(c,b):0,e.t+=d),this.$inner.css({top:-e.t}),d},getDifference:function(){return this.state.a-this.state.c},getEditorHeight:function(){var b=0;return this.$inner.find(".ace_text-layer").children().each(function(){b+=a(this).height()}),b}}}),a.fn.mivhak=function(b){return this.each(function(){if("object"!=typeof b&&b){if(e.methodExists(b)){var c=[];Array.prototype.push.apply(c,arguments),c.shift(),e.methods[b].apply(a(this).data("mivhak"),c)}}else if("undefined"==typeof a(this).data("mivhak")){var d=new e(this,b);a(this).data("mivhak",d)}else e.methods.update.call(a(this).data("mivhak"),[b])})}}(jQuery);