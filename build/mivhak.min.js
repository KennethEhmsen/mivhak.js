/**
 * Package:      mivhak-js
 * URL:          http://products.askupasoftware.com/mivhak-js
 * Version:      1.0.0
 * Date:         2016-07-11
 * Dependencies: jQuery Mousewheel, Ace Editor
 * License:      GNU GENERAL PUBLIC LICENSE
 *
 * Developed by Askupa Software http://www.askupasoftware.com
 */
!function(a){function b(a){return"true"===a.toLowerCase()?!0:"false"===a.toLowerCase()?!1:isNaN(a)?a:parseFloat(a)}function c(a){return a.replace(/-(.)/g,function(a){return a[1].toUpperCase()})}function d(d){var e={};return a.each(d.attributes,function(a,d){/^miv-/.test(d.name)&&(e[c(d.name.substr(4))]=b(d.value))}),e}function e(a){for(var b=a.length,c=0;b--;)c+=parseFloat(a[b]);return c/a.length}function f(a){for(var b=a.length,c=a[--b];b--;)a[b]>c&&(c=a[b]);return c}function g(a){for(var b=a.length,c=a[--b];b--;)a[b]<c&&(c=a[b]);return c}function h(b){var c=0;return b.find(".ace_text-layer").children().each(function(){c+=a(this).height()}),c}function i(a){for(var b,c,d,e=a.replace(" ","").split(","),f=e.length,g=[];f--;)e[f].indexOf("-")>-1?(d=e[f].split("-"),b=parseInt(d[0])-1,c=parseInt(d[1])-1):(b=parseInt(e[f])-1,c=b),g.unshift({start:b,end:c});return g}function j(b,c){b.getElementsByTagName("PRE").length&&(this.$selection=a(b),this.setOptions(c),this.init())}ace.config.set("basePath","https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.3/");var k=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1e3/60)};j.methodExists=function(a){return"string"==typeof a&&j.methods[a]},j.prototype.init=function(){this.initState(),this.parseResources(),this.createUI(),this.applyOptions(),this.callMethod("showTab",0)},j.prototype.applyOptions=function(){this.callMethod("setHeight",this.options.height),this.callMethod("setAccentColor",this.options.accentColor),this.options.collapsed&&this.callMethod("collapse"),this.options.topbar?this.$selection.removeClass("mivhak-no-topbar"):this.$selection.addClass("mivhak-no-topbar"),this.createCaption(),this.createLivePreview()},j.prototype.initState=function(){this.state={lineWrap:!0,collapsed:!1,height:0,activeTab:null,resources:[]}},j.prototype.setOptions=function(b){"undefined"!=typeof this.options?this.options=a.extend(!0,{},this.options,b,d(this.$selection[0])):this.options=a.extend(!0,{},j.defaults,b,d(this.$selection[0]))},j.prototype.callMethod=function(a){if(j.methodExists(a)){var b=[];Array.prototype.push.apply(b,arguments),b.shift(),j.methods[a].apply(this,b)}},j.prototype.createUI=function(){this.tabs=j.render("tabs",{mivhakInstance:this}),this.topbar=j.render("top-bar",{mivhakInstance:this}),this.notifier=j.render("notifier"),this.$selection.prepend(this.tabs.$el),this.$selection.prepend(this.topbar.$el),this.tabs.$el.prepend(this.notifier.$el)},j.prototype.calculateHeight=function(b){for(var c=[],d=2*this.options.padding,i=this.tabs.tabs.length;i--;)c.unshift(h(a(this.tabs.tabs[i].resource.pre))+d);return"average"===b?e(c):"min"===b?g(c):"max"===b?f(c):"auto"===b?h(a(this.activeTab.resource.pre))+d:isNaN(b)?c[0]:parseInt(b)},j.prototype.parseResources=function(){var a=this;this.resources=new l,this.$selection.find("pre").each(function(){a.resources.add(this)})},j.prototype.createCaption=function(){this.options.caption?this.caption?this.caption.setText(this.options.caption):(this.caption=j.render("caption",{text:this.options.caption}),this.$selection.append(this.caption.$el)):this.$selection.addClass("mivhak-no-caption")},j.prototype.createLivePreview=function(){this.options.runnable&&"undefined"==typeof this.preview&&(this.preview=j.render("live-preview",{resources:this.resources}),this.tabs.$el.append(this.preview.$el))},j.prototype.destroy=function(){this.$selection.empty()},j.defaults={runnable:!1,editable:!1,lineNumbers:!1,accentColor:!1,collapsed:!1,caption:!1,theme:"light",height:"average",padding:15,topbar:!0,buttons:["wrap","copy","collapse","about"]},j.resourceDefaults={lang:null,runAs:!1,source:!1,visible:!0,mark:!1,startLine:1};var l=function(){this.data=[]};l.prototype.count=function(){return this.data.length},l.prototype.add=function(b){this.data.push(a.extend({},j.resourceDefaults,{pre:b,content:b.textContent},d(b)))},l.prototype.get=function(a){return this.data[a]},l.prototype.update=function(a,b){this.data[a].content=b},j.buttons={wrap:{text:"Wrap Lines",toggle:!0,click:function(a){a.stopPropagation(),this.callMethod("toggleLineWrap")}},copy:{text:"Copy",click:function(a){this.callMethod("copyCode")}},collapse:{text:"Colllapse",click:function(a){this.callMethod("collapse")}},about:{text:"About Mivhak",click:function(a){this.notifier.closableNotification("Mivhak.js v1.0.0")}}},j.methods={toggleLineWrap:function(){var b=this;this.state.lineWrap=!this.state.lineWrap,a.each(this.tabs.tabs,function(a,c){c.editor.getSession().setUseWrapMode(b.state.lineWrap),c.vscroll.refresh(),c.hscroll.refresh()})},copyCode:function(){var a=this.activeTab.editor;a.selection.selectAll(),a.focus(),document.execCommand("copy")?(a.selection.clearSelection(),this.notifier.timedNotification("Copied to clipboard!",2e3)):this.notifier.timedNotification("Press &#8984;+C to copy the code",2e3)},collapse:function(){if(!this.state.collapsed){var a=this;this.state.collapsed=!0,this.notifier.closableNotification("Show Code",function(){a.callMethod("expand")}),this.$selection.addClass("mivhak-collapsed"),this.callMethod("setHeight",this.notifier.$el.outerHeight(!0))}},expand:function(){this.state.collapsed&&(this.state.collapsed=!1,this.notifier.hide(),this.$selection.removeClass("mivhak-collapsed"),this.callMethod("setHeight",this.options.height))},showTab:function(a){this.tabs.showTab(a),this.topbar.activateNavTab(a),this.options.runnable&&this.preview.hide()},setHeight:function(b){var c=this;k(function(){c.state.height=c.calculateHeight(b),c.tabs.$el.height(c.state.height),a.each(c.tabs.tabs,function(c,d){a(d.resource.pre).height(b),d.editor.resize(),d.vscroll.refresh(),d.hscroll.refresh()})})},setAccentColor:function(a){a&&(this.topbar.$el.find(".mivhak-top-bar-button").css({color:a}),this.topbar.$el.find(".mivhak-dropdown-button").css({color:a}),this.topbar.$el.find(".mivhak-controls svg").css({fill:a}),this.tabs.$el.find(".mivhak-scrollbar-thumb").css({"background-color":a}),this.topbar.line.css({"background-color":a}))}},j.icons={},j.icons.play='<svg viewBox="0 0 232.153 232.153"><g><path style="fill-rule:evenodd;clip-rule:evenodd;" d="M203.791,99.628L49.307,2.294c-4.567-2.719-10.238-2.266-14.521-2.266c-17.132,0-17.056,13.227-17.056,16.578v198.94c0,2.833-0.075,16.579,17.056,16.579c4.283,0,9.955,0.451,14.521-2.267l154.483-97.333c12.68-7.545,10.489-16.449,10.489-16.449S216.471,107.172,203.791,99.628z"/></g></svg>',j.icons.cog='<svg viewbox="0 0 438.529 438.529"><g><path d="M436.25,181.438c-1.529-2.002-3.524-3.193-5.995-3.571l-52.249-7.992c-2.854-9.137-6.756-18.461-11.704-27.98c3.422-4.758,8.559-11.466,15.41-20.129c6.851-8.661,11.703-14.987,14.561-18.986c1.523-2.094,2.279-4.281,2.279-6.567c0-2.663-0.66-4.755-1.998-6.28c-6.848-9.708-22.552-25.885-47.106-48.536c-2.275-1.903-4.661-2.854-7.132-2.854c-2.857,0-5.14,0.855-6.854,2.567l-40.539,30.549c-7.806-3.999-16.371-7.52-25.693-10.565l-7.994-52.529c-0.191-2.474-1.287-4.521-3.285-6.139C255.95,0.806,253.623,0,250.954,0h-63.38c-5.52,0-8.947,2.663-10.278,7.993c-2.475,9.513-5.236,27.214-8.28,53.1c-8.947,2.86-17.607,6.476-25.981,10.853l-39.399-30.549c-2.474-1.903-4.948-2.854-7.422-2.854c-4.187,0-13.179,6.804-26.979,20.413c-13.8,13.612-23.169,23.841-28.122,30.69c-1.714,2.474-2.568,4.664-2.568,6.567c0,2.286,0.95,4.57,2.853,6.851c12.751,15.42,22.936,28.549,30.55,39.403c-4.759,8.754-8.47,17.511-11.132,26.265l-53.105,7.992c-2.093,0.382-3.9,1.621-5.424,3.715C0.76,182.531,0,184.722,0,187.002v63.383c0,2.478,0.76,4.709,2.284,6.708c1.524,1.998,3.521,3.195,5.996,3.572l52.25,7.71c2.663,9.325,6.564,18.743,11.704,28.257c-3.424,4.761-8.563,11.468-15.415,20.129c-6.851,8.665-11.709,14.989-14.561,18.986c-1.525,2.102-2.285,4.285-2.285,6.57c0,2.471,0.666,4.658,1.997,6.561c7.423,10.284,23.125,26.272,47.109,47.969c2.095,2.094,4.475,3.138,7.137,3.138c2.857,0,5.236-0.852,7.138-2.563l40.259-30.553c7.808,3.997,16.371,7.519,25.697,10.568l7.993,52.529c0.193,2.471,1.287,4.518,3.283,6.14c1.997,1.622,4.331,2.423,6.995,2.423h63.38c5.53,0,8.952-2.662,10.287-7.994c2.471-9.514,5.229-27.213,8.274-53.098c8.946-2.858,17.607-6.476,25.981-10.855l39.402,30.84c2.663,1.712,5.141,2.563,7.42,2.563c4.186,0,13.131-6.752,26.833-20.27c13.709-13.511,23.13-23.79,28.264-30.837c1.711-1.902,2.569-4.09,2.569-6.561c0-2.478-0.947-4.862-2.857-7.139c-13.698-16.754-23.883-29.882-30.546-39.402c3.806-7.043,7.519-15.701,11.136-25.98l52.817-7.988c2.279-0.383,4.189-1.622,5.708-3.716c1.523-2.098,2.279-4.288,2.279-6.571v-63.376C438.533,185.671,437.777,183.438,436.25,181.438z M270.946,270.939c-14.271,14.277-31.497,21.416-51.676,21.416c-20.177,0-37.401-7.139-51.678-21.416c-14.272-14.271-21.411-31.498-21.411-51.673c0-20.177,7.135-37.401,21.411-51.678c14.277-14.272,31.504-21.411,51.678-21.411c20.179,0,37.406,7.139,51.676,21.411c14.274,14.277,21.413,31.501,21.413,51.678C292.359,239.441,285.221,256.669,270.946,270.939z"/></g></svg>',j.components=[],j.component=function(a,b){j.components[a]=b},j.render=function(b,c){var d=a.extend(!0,{},j.components[b]),e={};return e.$el=a(d.template),a.each(d.methods,function(a,b){e[a]=function(){return b.apply(e,arguments)}}),a.each(d.props,function(a,b){e[a]="undefined"!=typeof c&&c.hasOwnProperty(a)?c[a]:b}),a.each(d.events,function(a,b){e.$el.on(a,function(){return b.apply(e,arguments)})}),d.hasOwnProperty("created")&&d.created.call(e),e},j.component("caption",{template:'<div class="mivhak-caption"></div>',props:{text:null},created:function(){this.setText(this.text)},methods:{setText:function(a){this.$el.html(a)}}}),j.component("dropdown",{template:'<div class="mivhak-dropdown"></div>',props:{items:[],mivhakInstance:null,visible:!1},created:function(){var b=this;a.each(this.items,function(c,d){"string"==typeof d&&(d=j.buttons[d]);var e=a("<div>",{"class":"mivhak-dropdown-button",text:d.text,click:function(a){d.click.call(b.mivhakInstance,a)}});d.toggle&&(e.$toggle=j.render("toggle"),e.click(function(b){1!==a(b.target).parents(".mivhak-dropdown-button").length&&e.$toggle.toggle()}),e.append(e.$toggle.$el)),b.$el.append(e)}),a(window).click(function(c){a(c.target).closest(".mivhak-icon-cog").length||(b.$el.removeClass("mivhak-dropdown-visible"),b.$el.parent().removeClass("mivhak-button-active"))})},methods:{toggle:function(){this.visible=!this.visible,this.$el.toggleClass("mivhak-dropdown-visible")}}}),j.component("horizontal-scrollbar",{template:'<div class="mivhak-scrollbar mivhak-h-scrollbar"><div class="mivhak-scrollbar-thumb"></div></div>',props:{editor:null,$inner:null,$outer:null,mivhakInstance:null,minWidth:50,state:{a:0,b:0,c:0,d:0,l:0},initialized:!1},methods:{initialize:function(){if(!this.initialized){this.initialized=!0,this.dragDealer();var b=this;a(window).resize(function(){b.mivhakInstance.state.lineWrap||b.refresh()})}this.refresh()},updateState:function(){var b=a.extend({},this.state);return this.state.a=this.getEditorWidth(),this.state.b=this.$outer.parent().width(),this.state.c=this.state.b-2*this.mivhakInstance.options.padding,this.state.d=Math.max(this.state.c*this.state.b/this.state.a,this.minWidth),this.state.l*=this.state.a/Math.max(b.a,1),this.state.a!==b.a||this.state.b!==b.b},refresh:function(){var a=this,b=this.state.l;k(function(){a.updateState()&&(a.getDifference()>0?(a.doScroll("left",b-a.state.l),a.$el.css({width:a.state.d+"px",left:0}),a.moveBar()):(a.doScroll("left",a.state.l),a.$el.css({width:0})))})},dragDealer:function(){function b(a){var b,c=a.pageX-d;c&&(d=a.pageX,k(function(){b=e.doScroll(c>0?"right":"left",Math.abs(c*e.getEditorWidth()/e.$outer.parent().width())),0!==b&&e.moveBar()}))}function c(){e.$el.add(document.body).removeClass("mivhak-scrollbar-grabbed"),a(document).off("mousemove.drag mouseup.drag")}var d,e=this;this.$el.on("mousedown.drag",function(f){return d=f.pageX,e.$el.add(document.body).addClass("mivhak-scrollbar-grabbed"),a(document).on("mousemove.drag",b).on("mouseup.drag",c),!1})},moveBar:function(){this.$el.css({left:(this.state.b-this.state.d)/(this.state.a-this.state.c)*this.state.l+"px"})},doScroll:function(a,b){var c,d,e=this.state;return"left"===a&&(c=e.l,d=c>0?Math.min(c,b):0,e.l-=d),"right"===a&&(c=this.getDifference()-e.l,d=c>0?Math.min(c,b):0,e.l+=d),this.$inner.find(".ace_content").css({"margin-left":-e.l}),d},getDifference:function(){return this.state.a-this.state.c},getEditorWidth:function(){return this.$inner.find(".ace_content").width()}}}),j.component("live-preview",{template:'<iframe class="mivhak-live-preview" allowtransparency="true" sandbox="allow-scripts allow-pointer-lock allow-same-origin allow-popups allow-modals allow-forms" frameborder="0"></iframe>',props:{resources:[]},methods:{renderHTML:function(){var a="<html>",b="<head>",c="<body>";b+='<meta http-equiv="content-type" content="text/html; charset=UTF-8">',b+='<meta name="robots" content="noindex, nofollow">',b+='<meta name="googlebot" content="noindex, nofollow">';for(var d=0;d<this.resources.count();d++){var e=this.resources.get(d);"markup"===e.runAs&&(c+=e.content),"style"===e.runAs&&(b+=this.createStyle(e.content,e.visible?!1:e.source)),"script"===e.runAs&&(b+=this.createScript(e.content,e.visible?!1:e.source))}return a+=b+"</head>"+c+"</body></html>"},createScript:function(a,b){return b?'<script src="'+b+'" type="text/javascript"></script>':"<script>\n//<![CDATA[\nwindow.onload = function(){"+a+"};//]]>\n</script>"},createStyle:function(a,b){return b?'<link href="'+b+'" rel="stylesheet">':"<style>"+a+"</style>"},show:function(){this.$el.addClass("mivhak-active"),this.run()},hide:function(){this.$el.removeClass("mivhak-active")},run:function(){var a=this.$el.contents(),b=a[0];b.open(),b.writeln(this.renderHTML()),b.close()}}}),j.component("notifier",{template:'<div class="mivhak-notifier"></div>',methods:{notification:function(a){a&&(clearTimeout(this.timeout),this.$el.off("click"),this.$el.html(a),this.$el.addClass("mivhak-visible"))},timedNotification:function(a,b){var c=this;this.notification(a),this.timeout=setTimeout(function(){c.hide()},b)},closableNotification:function(a,b){var c=this;this.notification(a),this.$el.addClass("mivhak-button"),this.$el.click(function(a){c.hide(),"undefined"!=typeof b&&b.call(null,a)})},hide:function(){this.$el.removeClass("mivhak-visible mivhak-button")}}}),j.component("tab-pane",{template:'<div class="mivhak-tab-pane"><div class="mivhak-tab-pane-inner"></div></div>',props:{resource:null,editor:null,index:null,padding:10,mivhakInstance:null},created:function(){this.setEditor(),this.fetchRemoteSource(),this.markLines(),this.$el=a(this.resource.pre).wrap(this.$el).parent().parent(),this.$el.find(".mivhak-tab-pane-inner").css({margin:this.mivhakInstance.options.padding}),this.setScrollbars()},methods:{getTheme:function(){return"light"===this.mivhakInstance.options.theme?"clouds":"ambiance"},fetchRemoteSource:function(){var b=this;this.resource.source&&a.ajax(this.resource.source).done(function(a){b.editor.setValue(a,-1),b.mivhakInstance.callMethod("setHeight",b.mivhakInstance.options.height),k(function(){b.vscroll.refresh(),b.hscroll.refresh()})})},setScrollbars:function(){var b=a(this.resource.pre),c=this.$el.find(".mivhak-tab-pane-inner");this.vscroll=j.render("vertical-scrollbar",{editor:this.editor,$inner:b,$outer:c,mivhakInstance:this.mivhakInstance}),this.hscroll=j.render("horizontal-scrollbar",{editor:this.editor,$inner:b,$outer:c,mivhakInstance:this.mivhakInstance}),this.$el.append(this.vscroll.$el,this.hscroll.$el)},show:function(){this.$el.addClass("mivhak-tab-pane-active"),this.editor.focus(),this.editor.gotoLine(0),this.vscroll.initialize(),this.hscroll.initialize()},hide:function(){this.$el.removeClass("mivhak-tab-pane-active")},setEditor:function(){if(this.resource.pre.textContent=this.resource.pre.textContent.trim(),this.editor=ace.edit(this.resource.pre),this.editor.setReadOnly(!this.mivhakInstance.options.editable),this.editor.setTheme("ace/theme/"+this.getTheme()),this.editor.setShowPrintMargin(!1),this.editor.renderer.setShowGutter(this.mivhakInstance.options.lineNumbers),this.editor.getSession().setMode("ace/mode/"+this.resource.lang),this.editor.getSession().setUseWorker(!1),this.editor.getSession().setUseWrapMode(!0),this.editor.setOptions({maxLines:1/0,firstLineNumber:this.resource.startLine,highlightActiveLine:!1,fontSize:parseInt(14)}),this.mivhakInstance.options.editable){var a=this;this.editor.getSession().on("change",function(b,c,d){a.mivhakInstance.resources.update(a.index,a.editor.getValue())})}},markLines:function(){if(this.resource.mark)for(var a=i(this.resource.mark),b=a.length,c=ace.require("ace/range").Range;b--;)this.editor.session.addMarker(new c(a[b].start,0,a[b].end,1),"ace_active-line","fullLine")}}}),j.component("tabs",{template:'<div class="mivhak-tabs"></div>',props:{mivhakInstance:null,activeTab:null,tabs:[]},created:function(){var b=this;this.$el=this.mivhakInstance.$selection.find("pre").wrapAll(this.$el).parent(),a.each(this.mivhakInstance.resources.data,function(a,c){c.visible&&b.tabs.push(j.render("tab-pane",{resource:c,index:a,mivhakInstance:b.mivhakInstance}))})},methods:{showTab:function(b){var c=this;a.each(this.tabs,function(a,d){b===a?(c.mivhakInstance.activeTab=d,d.show()):d.hide()})}}}),j.component("toggle",{template:'<div class="mivhak-toggle"><div class="mivhak-toggle-knob"></div></div>',props:{on:!0},events:{click:function(){this.toggle()}},created:function(){this.$el.addClass("mivhak-toggle-"+(this.on?"on":"off"))},methods:{toggle:function(){this.on=!this.on,this.$el.toggleClass("mivhak-toggle-on").toggleClass("mivhak-toggle-off")}}}),j.component("top-bar-button",{template:'<div class="mivhak-top-bar-button"></div>',props:{text:null,icon:null,dropdown:null,mivhakInstance:null,onClick:function(){}},events:{click:function(){this.onClick()}},created:function(){var b=this;this.$el.text(this.text),this.icon&&this.$el.addClass("mivhak-icon mivhak-icon-"+this.icon).append(a(j.icons[this.icon])),this.dropdown&&(b.$el.append(this.dropdown.$el),this.onClick=function(){b.toggleActivation(),b.dropdown.toggle()})},methods:{activate:function(){this.$el.addClass("mivhak-button-active")},deactivate:function(){this.$el.removeClass("mivhak-button-active")},toggleActivation:function(){this.$el.toggleClass("mivhak-button-active")},isActive:function(){return this.$el.hasClass("mivhak-button-active")}}}),j.component("top-bar",{template:'<div class="mivhak-top-bar"><div class="mivhak-nav-tabs"></div><div class="mivhak-controls"></div><div class="mivhak-line"></div></div>',props:{mivhakInstance:null,navTabs:[],controls:[],line:null},created:function(){this.line=this.$el.find(".mivhak-line"),this.createTabNav(),this.mivhakInstance.options.runnable&&this.createPlayButton(),this.createCogButton()},methods:{activateNavTab:function(b){var c=this.navTabs[b];a.each(this.navTabs,function(a,b){b.deactivate()}),c.activate(),this.moveLine(c.$el)},moveLine:function(a){return"undefined"==typeof a?void this.line.removeClass("mivhak-visible"):(this.line.width(a.width()),this.line.css({left:a.position().left+(a.outerWidth()-a.width())/2}),void this.line.addClass("mivhak-visible"))},createTabNav:function(){var a,b,c=0;for(b=0;b<this.mivhakInstance.resources.count();b++)a=this.mivhakInstance.resources.get(b),a.visible&&this.createNavTabButton(c++,a.lang)},createNavTabButton:function(a,b){var c=this,d=j.render("top-bar-button",{text:b,onClick:function(){c.mivhakInstance.callMethod("showTab",a)}});this.navTabs.push(d),this.$el.find(".mivhak-nav-tabs").append(d.$el)},createPlayButton:function(){var a=this,b=j.render("top-bar-button",{icon:"play",onClick:function(){a.mivhakInstance.preview.show(),a.moveLine()}});this.controls.push(b),this.$el.find(".mivhak-controls").append(b.$el)},createCogButton:function(){var a=j.render("top-bar-button",{icon:"cog",mivhakInstance:this.mivhakInstance,dropdown:j.render("dropdown",{mivhakInstance:this.mivhakInstance,items:this.mivhakInstance.options.buttons})});this.controls.push(a),this.$el.find(".mivhak-controls").append(a.$el)}}}),j.component("vertical-scrollbar",{template:'<div class="mivhak-scrollbar mivhak-v-scrollbar"><div class="mivhak-scrollbar-thumb"></div></div>',props:{editor:null,$inner:null,$outer:null,mivhakInstance:null,minHeight:50,state:{a:0,b:0,c:0,d:0,t:0},initialized:!1},methods:{initialize:function(){if(!this.initialized){this.initialized=!0,this.dragDealer();var b=this;this.$inner.on("mousewheel",function(a){b.onScroll.call(this,a)}),a(window).resize(function(){b.mivhakInstance.state.lineWrap&&b.refresh()})}this.refresh()},updateState:function(){var b=a.extend({},this.state);return this.state.a=h(this.$inner),this.state.b=this.mivhakInstance.state.height,this.state.c=this.mivhakInstance.state.height-2*this.mivhakInstance.options.padding,this.state.d=Math.max(this.state.c*this.state.b/this.state.a,this.minHeight),this.state.t*=this.state.a/Math.max(b.a,1),this.state.a!==b.a||this.state.b!==b.b},refresh:function(){var a=this,b=this.state.t;k(function(){a.updateState()&&(a.getDifference()>0?(a.doScroll("up",b-a.state.t),a.$el.css({height:a.state.d+"px",top:0}),a.moveBar()):(a.doScroll("up",a.state.t),a.$el.css({height:0})))})},onScroll:function(a){var b;b=a.deltaY>0?this.doScroll("up",a.deltaY*a.deltaFactor):this.doScroll("down",-a.deltaY*a.deltaFactor),0!==b&&(this.moveBar(),a.preventDefault())},dragDealer:function(){function b(a){var b,c=a.pageY-d;c&&(d=a.pageY,k(function(){b=e.doScroll(c>0?"down":"up",Math.abs(c*h(e.$inner)/e.$outer.parent().height())),0!==b&&e.moveBar()}))}function c(){e.$el.add(document.body).removeClass("mivhak-scrollbar-grabbed"),a(document).off("mousemove.drag mouseup.drag")}var d,e=this;this.$el.on("mousedown.drag",function(f){return d=f.pageY,e.$el.add(document.body).addClass("mivhak-scrollbar-grabbed"),a(document).on("mousemove.drag",b).on("mouseup.drag",c),!1})},moveBar:function(){this.$el.css({top:(this.state.b-this.state.d)/(this.state.a-this.state.c)*this.state.t+"px"})},doScroll:function(a,b){var c,d,e=this.state;return"up"===a&&(c=e.t,d=c>0?Math.min(c,b):0,e.t-=d),"down"===a&&(c=this.getDifference()-e.t,d=c>0?Math.min(c,b):0,e.t+=d),this.$inner.css({top:-e.t}),d},getDifference:function(){return this.state.a-this.state.c}}}),a.fn.mivhak=function(b){var c=arguments.length>1?Array.apply(null,arguments).slice(1):null;return this.each(function(){if("object"!=typeof b&&b)j.methodExists(b)&&j.methods[b].apply(a(this).data("mivhak"),c);else if("undefined"==typeof a(this).data("mivhak")){var d=new j(this,b);a(this).data("mivhak",d)}else a(this).data("mivhak").setOptions(b),a(this).data("mivhak").applyOptions()})}}(jQuery);